@model SafeBet.Models.RouletteViewModel
@{
    ViewData["Title"] = "Roulette";
}

@section Styles {
    <link rel="stylesheet" href="~/css/roulette.css" asp-append-version="true" />
}

<div class="roulette-container">
    <div class="container-fluid">
        <!-- Header -->
        <header class="roulette-header">
            <h1 class="roulette-title">ðŸŽ° ROULETTE ðŸŽ°</h1>
        </header>

        <!-- Alert Messages -->
        @if (TempData["Message"] != null)
        {
            <div class="alert alert-@(TempData["MessageType"]) alert-dismissible fade show roulette-alert" role="alert">
                @TempData["Message"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        <!-- Game Status Section -->
        <section class="roulette-status-section">
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="status-card">
                        <h5 class="status-title">Game Status</h5>
                        @if (Model.Game.LastResult.HasValue)
                        {
                            <div class="status-content">
                                <div class="last-result">
                                    <span class="label">Last Result:</span>
                                    <span class="result-number @(Model.Game.LastColor == "red" ? "red-number" : Model.Game.LastColor == "black" ? "black-number" : "green-number")">
                                        @Model.Game.LastResult
                                    </span>
                                    <span class="result-color">(@Model.Game.LastColor)</span>
                                </div>
                                <div class="winnings">
                                    <span class="label">Total Winnings:</span>
                                    <span class="@(Model.Game.TotalWinnings > 0 ? "text-success" : Model.Game.TotalWinnings < 0 ? "text-danger" : "text-muted")">
                                        $@Model.Game.TotalWinnings
                                    </span>
                                </div>
                            </div>
                        }
                        else
                        {
                            <p class="status-content">No games played yet.</p>
                        }
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="status-card">
                        <h5 class="status-title">Current Bets</h5>
                        @if (Model.Game.CurrentBets.Any())
                        {
                            <div class="status-content">
                                <div class="total-bet">
                                    <span class="label">Total Bet:</span>
                                    <span class="amount">$@Model.Game.GetTotalBetAmount()</span>
                                </div>
                                <div class="bets-list">
                                    @foreach (var bet in Model.Game.CurrentBets)
                                    {
                                        <span class="bet-badge">@bet.BetType: $@bet.Amount</span>
                                    }
                                </div>
                            </div>
                        }
                        else
                        {
                            <p class="status-content">No bets placed.</p>
                        }
                    </div>
                </div>
            </div>
        </section>

        <!-- Wheel and Controls Section -->
        <section class="roulette-game-section">
            <!-- Roulette Wheel -->
            <div class="roulette-wheel-section">
                <div class="wheel-container">
                    <h3 class="wheel-title">Roulette Wheel</h3>
                    <div class="wheel-wrapper">
                        <div class="wheel-stand"></div>
                        <div class="wheel-outer">
                            <div class="wheel" id="rouletteWheel">
                                <!-- Wheel will be generated by JavaScript -->
                            </div>
                            <div class="wheel-center">
                                <img src="@Url.Content("~/images/11792-logo-2c795213-9c33-46f3-80f5-c79c71e28df2-safe bet.png")" alt="SafeBet" class="wheel-logo-img" />
                            </div>
                            <div class="ball-track">
                            </div>
                        </div>
                        <!-- Static deflector -->
                        <div class="deflector"></div>
                        <div class="result-display" id="resultDisplay">
                            <div class="result-number-display" id="resultNumberDisplay">
                                @if (Model.Game.LastResult.HasValue)
                                {
                                    <span class="@(Model.Game.LastColor == "red" ? "red-number" : Model.Game.LastColor == "black" ? "black-number" : "green-number")">
                                        @Model.Game.LastResult
                                    </span>
                                }
                                else
                                {
                                    <span>-</span>
                                }
                            </div>
                            <div class="result-label">WINNING NUMBER</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Betting Controls -->
            <div class="roulette-controls-section">
                <div class="controls-card">
                    <h5 class="controls-title">Betting Controls</h5>
                    <div class="controls-content">
                        <form asp-action="PlaceBet" method="post" class="bet-form">
                            <div class="bet-input-group">
                                <label for="betAmount">Bet Amount:</label>
                                <input type="number" name="betAmount" id="betAmount" value="@Model.BetAmount" min="1" class="form-control bet-input" placeholder="Amount" required>
                                <input type="hidden" name="betType" id="selectedBetType" value="" required>
                                <button type="submit" class="btn btn-primary bet-btn" onclick="return validateBet()">Place Bet</button>
                            </div>
                            <small class="bet-hint">Click on a number or betting area first</small>
                        </form>
                        <div class="action-buttons">
                            <form asp-action="Spin" method="post" id="spinForm">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-success btn-lg spin-btn" id="spinButton">
                                    <span class="spin-text">SPIN</span>
                                    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                                </button>
                            </form>
                            <form asp-action="ClearBets" method="post">
                                <button type="submit" class="btn btn-warning action-btn">Clear Bets</button>
                            </form>
                            <form asp-action="ToggleOdds" method="post">
                                <button type="submit" class="btn btn-info action-btn">
                                    @(Model.Game.ShowOdds ? "Hide" : "Show") Odds
                                </button>
                            </form>
                            <button type="button" class="btn btn-secondary action-btn" id="resetWheelBtn" onclick="resetWheel()">Reset Wheel</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Betting Table Section -->
        <section class="roulette-table-section">
            <div class="betting-table-card">
                <h4 class="table-title">Betting Table</h4>
                
                <!-- Dozens -->
                <div class="row mb-3">
                    <div class="col-4">
                        <button class="btn btn-outline-primary w-100 bet-button" data-bet="1st12" onclick="selectBet('1st12')">
                            1st 12
                            @if (Model.Game.ShowOdds) { <small>(2:1)</small> }
                        </button>
                    </div>
                    <div class="col-4">
                        <button class="btn btn-outline-primary w-100 bet-button" data-bet="2nd12" onclick="selectBet('2nd12')">
                            2nd 12
                            @if (Model.Game.ShowOdds) { <small>(2:1)</small> }
                        </button>
                    </div>
                    <div class="col-4">
                        <button class="btn btn-outline-primary w-100 bet-button" data-bet="3rd12" onclick="selectBet('3rd12')">
                            3rd 12
                            @if (Model.Game.ShowOdds) { <small>(2:1)</small> }
                        </button>
                    </div>
                </div>

                <!-- Main Numbers Grid -->
                <div class="row">
                    <div class="col-1">
                        <!-- Zero Column -->
                        <div class="d-grid gap-1 mb-2">
                            @{
                                string winningZeroClass = (Model.Game.LastResult.HasValue && Model.Game.LastResult.Value == 0) ? "winning-button" : "";
                                string winningDoubleZeroClass = (Model.Game.LastResult.HasValue && Model.Game.LastResult.Value == 00) ? "winning-button" : "";
                            }
                            <button class="btn btn-success bet-button @winningZeroClass" data-bet="0" onclick="selectBet('0')">
                                0
                                @if (Model.Game.ShowOdds) { <small>(35:1)</small> }
                            </button>
                            <button class="btn btn-success bet-button @winningDoubleZeroClass" data-bet="00" onclick="selectBet('00')">
                                00
                                @if (Model.Game.ShowOdds) { <small>(35:1)</small> }
                            </button>
                        </div>
                    </div>
                    <div class="col-9">
                        <!-- Numbers 1-36 -->
                        @for (int row = 0; row < 12; row++)
                        {
                            <div class="row mb-1">
                                @for (int col = 0; col < 3; col++)
                                {
                                    int number = (row * 3) + col + 1;
                                    bool isRed = new[]{1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36}.Contains(number);
                                    string colorClass = isRed ? "btn-danger" : "btn-dark";
                                    <div class="col-4">
                                        @{
                                            string winningButtonClass = (Model.Game.LastResult.HasValue && Model.Game.LastResult.Value == number) ? "winning-button" : "";
                                        }
                                        <button class="btn @colorClass w-100 bet-button @winningButtonClass" data-bet="@number" onclick="selectBet('@number')">
                                            @number
                                            @if (Model.Game.ShowOdds) { <small>(35:1)</small> }
                                        </button>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                    <div class="col-2">
                        <!-- Column Bets -->
                        <div class="d-grid gap-1">
                            <button class="btn btn-warning bet-button" data-bet="col1" onclick="selectBet('col1')">
                                2 to 1
                                @if (Model.Game.ShowOdds) { <small>(2:1)</small> }
                            </button>
                            <button class="btn btn-warning bet-button" data-bet="col2" onclick="selectBet('col2')">
                                2 to 1
                                @if (Model.Game.ShowOdds) { <small>(2:1)</small> }
                            </button>
                            <button class="btn btn-warning bet-button" data-bet="col3" onclick="selectBet('col3')">
                                2 to 1
                                @if (Model.Game.ShowOdds) { <small>(2:1)</small> }
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Outside Bets -->
                <div class="row mt-3">
                    <div class="col-2">
                        <button class="btn btn-outline-secondary w-100 bet-button" data-bet="1to18" onclick="selectBet('1to18')">
                            1 to 18
                            @if (Model.Game.ShowOdds) { <small>(1:1)</small> }
                        </button>
                    </div>
                    <div class="col-2">
                        <button class="btn btn-outline-secondary w-100 bet-button" data-bet="even" onclick="selectBet('even')">
                            EVEN
                            @if (Model.Game.ShowOdds) { <small>(1:1)</small> }
                        </button>
                    </div>
                    <div class="col-2">
                        <button class="btn btn-danger w-100 bet-button" data-bet="red" onclick="selectBet('red')">
                            RED
                            @if (Model.Game.ShowOdds) { <small>(1:1)</small> }
                        </button>
                    </div>
                    <div class="col-2">
                        <button class="btn btn-dark w-100 bet-button" data-bet="black" onclick="selectBet('black')">
                            BLACK
                            @if (Model.Game.ShowOdds) { <small>(1:1)</small> }
                        </button>
                    </div>
                    <div class="col-2">
                        <button class="btn btn-outline-secondary w-100 bet-button" data-bet="odd" onclick="selectBet('odd')">
                            ODD
                            @if (Model.Game.ShowOdds) { <small>(1:1)</small> }
                        </button>
                    </div>
                    <div class="col-2">
                        <button class="btn btn-outline-secondary w-100 bet-button" data-bet="19to36" onclick="selectBet('19to36')">
                            19 to 36
                            @if (Model.Game.ShowOdds) { <small>(1:1)</small> }
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Game History Section -->
        @if (Model.Game.GameHistory.Any())
        {
            <section class="roulette-history-section">
                <div class="history-card">
                    <h5 class="history-title">Game History</h5>
                    <div class="table-responsive">
                        <table class="table table-sm history-table">
                            <thead>
                                <tr>
                                    <th>Result</th>
                                    <th>Color</th>
                                    <th>Total Bet</th>
                                    <th>Winnings</th>
                                    <th>Net</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var game in Model.Game.GameHistory.TakeLast(10).Reverse())
                                {
                                    <tr>
                                        <td>@game.Result</td>
                                        <td><span class="badge bg-@(game.Color == "red" ? "danger" : game.Color == "black" ? "dark" : "success")">@game.Color.ToUpper()</span></td>
                                        <td>$@game.TotalBet</td>
                                        <td>$@game.Winnings</td>
                                        <td class="@(game.NetWinnings > 0 ? "text-success" : game.NetWinnings < 0 ? "text-danger" : "text-muted")">
                                            $@game.NetWinnings
                                        </td>
                                        <td>@game.Timestamp.ToString("HH:mm:ss")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        }
    </div>
</div>

@section Scripts {
    <script src="~/js/roulette.js" asp-append-version="true"></script>
    <script>
        // Initialize wheel with last result
        const lastResult = @(Model.Game.LastResult.HasValue ? Model.Game.LastResult.Value : -1);
        if (lastResult !== -1) {
            setTimeout(() => {
                if (typeof highlightWinningNumber === 'function') {
                    highlightWinningNumber(lastResult);
                }
            }, 300);
        }
    </script>
}
